@model PreferencesViewModel

<div class="row" id="row1">

    <!--<a class="waves-effect waves-light btn modal-trigger" style="position: fixed; right: 20px; bottom: 10px" href="#modal1">Lista miejsc</a>

    <!-- Modal Structure -->
    <div id="modal1" class="modal bottom-sheet">
        <div class="modal-content">
            <h5>Lista miejsc</h5>
            <ul class="collection" id="listOfPlaces">
            </ul>
            
        </div>
        <!--<div class="modal-footer">
            <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat" style="position:absolute">Agree</a>
        </div>-->
        </div>

    <div class="col s2">
        <form asp-controller="TripMap" asp-action="#" method="post" role="form">
            <br /> <!-- Prowizorka -->
            <div class="input-field col s12">
                <i class="material-icons prefix">room</i>
                <input asp-for="City" id="city_poc" type="text" class="validate">
                <label asp-for="City" for="city_poc"></label>
            </div>
            <div class="col s12">
                <i class="tiny material-icons prefix">today</i>
                <label asp-for="BeginTrip" for="start_date"></label>
                <input asp-for="BeginTrip" type="date" id="start_date" class="datepicker">
                <br />
                <i class="tiny material-icons prefix">today</i>
                <label asp-for="EndTrip" for="end_date"></label>
                <input asp-for="EndTrip" type="date" id="end_date" class="datepicker">
            </div>

            <ul class="collection with-header">
                <li class="collection-header" style="font-size: small; color: #0d47a1;">Zwiedzanie</li>
                <li class="collection-item">
                    <input value="true" class="filled-in" asp-checkbox-for="Monuments"/>
                    <br />
                    <input value="true" class="filled-in" asp-checkbox-for="Museum" />

                </li>    
            </ul>
            <ul class="collection with-header">
                <li class="collection-header" style="font-size: small; color: #0d47a1;">Rozrywka</li>
                <li class="collection-item">
                    <input value="true" class="filled-in" asp-checkbox-for="Club" />
                    <br />
                    <input value="true" class="filled-in" asp-checkbox-for="Cinema" />
                </li>
            </ul>
            <ul class="collection with-header">
                <li class="collection-header" style="font-size: small; color: #0d47a1;">Inne</li>
                <li class="collection-item">
                    <input value="true" class="filled-in" asp-checkbox-for="Food" />
                </li>
            </ul>

        </form>
        @*<div class="col s2">
            <button class="waves-effect waves-light btn" onclick="generateTripRoute();">Generuj trasę</button>
        </div>*@
    </div>
    <div class="col s10">
        <div id="map" style="min-height: 500px; min-height: 800px"></div>
    </div>
</div>  

@section Scripts {
    <script src="https://maps.googleapis.com/maps/api/js?v=3.22&libraries=places,maps"></script>
    <script>
        var map = null;
        var infowindow = null;
        var trip = {};
        var selectedPlaceTypes = [];
        var markers = [];
        var seMarkers = [];
        var placeService;
        var autocompleteCities;
        var specMarkers = [];
        var labelIndex = 0;
        var placeRadius = 400;
        var listButton = null;

        var directionsService;
        var directionsDisplay;

        var startPlace = undefined; // marker z wlasnym 'click'iem 
        var endPlace = undefined;

        // -----

        function addPlaceToTrip(place)
        {
            alert("elo");

        }

        function showOptions(event)
        {
            if (specMarkers.length != 0) {
                delSpecMarkers();
            }

            var marker = new google.maps.Marker({
                position: event.latLng,
                map: map
            });
            //ustawione tylko na chwile, jak masz chwile to weźże skasuj tego markera człowieku kappa keepo kappaClaus (prawilnie)
            marker.setVisible(false);
            /*
            According to Info Windows Guidelines,
                You are advised not to place interactive components — such as buttons, checkboxes, or text inputs — 
                within your custom info window.
            -> czyli trochę kappa z takim buttonem
            -> wiemy, wiemy ale poki co olac to :D*/
            
            var content = document.createElement('div');

            var restaurant = content.appendChild(document.createElement('button'));
            restaurant.innerHTML = 'Odwiedź restauracje';
            restaurant.className = 'waves-effect waves-light btn';
            restaurant.onclick = function () {
                findClosestRestaurants(event)
            };

            var atm = content.appendChild(document.createElement('button'));
            atm.innerHTML = 'Znajdź bankomat';
            atm.className = 'waves-effect waves-light btn';
            atm.onclick = function () {
                findClosestAtm(event);
            }

            if (infowindow != null) {
                infowindow.close();
            } else {
                infowindow = new google.maps.InfoWindow();
            }
            infowindow.setContent(content);
            infowindow.open(map, marker);
        }

        function loadMapAndPlaceService()
        {
            var mapCanvas = document.getElementById('map');
            var mapOptions = {
                center: new google.maps.LatLng(50.0468548, 19.9348337),
                zoom: 12,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };

            map = new google.maps.Map(mapCanvas, mapOptions);

            placeService = new google.maps.places.PlacesService(map);
        }


        function setupCitiesAutocomplete()
        {
            var defaultBounds = new google.maps.LatLngBounds(
                new google.maps.LatLng(-90, -180),
                new google.maps.LatLng(90, 180));

            var autocompleteOptions = {
                bounds: defaultBounds,
                types: ['(cities)']
            };

            autocompleteCities = new google.maps.places.Autocomplete(document.getElementById('city_poc'), autocompleteOptions);
            google.maps.event.addListener(autocompleteCities, 'place_changed', function () {
                var place = autocompleteCities.getPlace();
                map.panTo(place.geometry.location);

                askForStartAndEndPlace();
            });
        }

        /*
        mozliwe, ze to zrobimy jakos sprytniej ale poki co moze to tak dzialac
        */
        function setupCheckboxListener()
        {
            $(':checkbox').change(function () {
                var placeMap = {
                    'Monuments': ['city_hall', 'museum', 'point_of_interest'],
                    'Museum': [],
                    'Club': ['bar', 'cafe'],
                    'Food': ['restaurant', 'meal_takeaway'],
                    //'Art': ['art_gallery'],
                    'Cinema': ['movie_theater'],
                    //'Fun': ['amusement_park', 'zoo']
                };

                selectedPlaceTypes = [];
                $(':checkbox').each(function () {
                    if (this.checked) {
                        selectedPlaceTypes = selectedPlaceTypes.concat(placeMap[this.id]);
                    }
                });

                for (var i = 0; i < markers.length; ++i) {
                    if (trip[markers[i].position] == undefined) {
                        markers[i].setMap(null);
                        delete markers[i];
                    }
                }
                markers = [];


                var parent = document.getElementById("listOfPlaces");

                var numberOfChilds = document.getElementById("listOfPlaces").children.length;

                for (var i = 0; i < numberOfChilds; ++i)
                {
                    parent.removeChild(parent.childNodes[0]);
                    
                }

                if (listButton != null && selectedPlaceTypes.length == 0) {
                    document.getElementById("listButton").remove();
                    listButton = null;
                }

                if (selectedPlaceTypes.length == 0) {
                    return;
                }
                if (listButton == null) {
                    listButton = document.createElement('a');
                    document.getElementById("row1").appendChild(listButton);
                    listButton.id = 'listButton';
                    listButton.className = 'waves-effect waves-light btn modal-trigger';
                    listButton.style.position = 'fixed';
                    listButton.style.right = '20px';
                    listButton.style.bottom = '10px';
                    listButton.href = '#modal1';
                    listButton.innerHTML = 'Lista miejsc';
                    listButton.onclick = function () {
                        $('#modal1').openModal({ opacity: 0 });
                    }
                }

                placeService.nearbySearch({
                    location: autocompleteCities.getPlace().geometry.location,
                    radius: 5000,
                    types: selectedPlaceTypes
                }, function (results, status) {
                    if (status === google.maps.places.PlacesServiceStatus.OK) {
                        var places = results;
                        for (var i = 0; i < places.length; i++) {
                            placeMark(places[i]);
                        }
                    }
                });

            });

        }

        function placeMark(place)
        {
            if (trip[place.geometry.location] != undefined) {
                return;
            }

            var marker = new google.maps.Marker({
                map: map,
                position: place.geometry.location,
            });

            markers.push(marker);

            google.maps.event.addListener(marker, 'click', function () {
                placeDetailInfo(place, this);
            });
        }

        function placeDetailInfo(place, marker)
        {
            var request = { placeId: place.place_id };
            placeService.getDetails(request, function (details, status) {
                console.log(status);
                if (status !== google.maps.places.PlacesServiceStatus.OK) {
                    return;
                }

                var button = document.createElement('a');
                var label = document.createElement('label')
                var icon = document.createElement('i');
                var photos = place.photos;
                var photoURL = photos ? photos[0].getUrl({ 'maxWidth': 100, 'maxHeight': 100 }) : null;

                var placeItem = document.createElement('li');
                placeItem.className = 'collection-item avatar';
                document.getElementById("listOfPlaces").appendChild(placeItem);
                placeItem.style.fontSize = '12px';

                var placeAvatar = document.createElement('img');
                placeAvatar.className = 'circle';
                placeAvatar.src = photoURL;
                placeItem.appendChild(placeAvatar);

                var placeName = document.createElement('span');
                placeName.className = 'title';
                placeItem.appendChild(placeName);

                var placeData = document.createElement('p');
                placeItem.appendChild(placeData);

                var button_list = document.createElement('a');
                var icon_list = document.createElement('i');

                placeItem.appendChild(button_list);
                button_list.appendChild(icon_list);
                icon_list.className = 'material-icons';

                placeName.innerHTML = '<b>' + details.name + '</b>';
                placeData.innerHTML = details.formatted_address + "<br />" +
                            details.formatted_phone_number + "<br />" +
                            "<a href=" + details.website + ">" + details.website + "</a><br />" +
                            "Ocena: <span style=color:#01579b;>" + details.rating + "</span>";

                if (infowindow != null) {
                    infowindow.close();
                } else {
                    infowindow = new google.maps.InfoWindow();
                }

                var content = document.createElement('div');
                photos = place.photos;
                if (!photos) {
                    content.innerHTML = "<strong>" + details.name + "</strong>" + "<br />" +
                        details.formatted_address + "<br />" +
                        details.formatted_phone_number + "<br />" +
                        "<a href=" + details.website + ">" + details.website + "</a><br />" +
                        "Ocena: <span style=color:#01579b;>" + details.rating + "</span><br /><br />";
                } else {
                    var photoURL = photos[0].getUrl({ 'maxWidth': 1200, 'maxHeight': 700 });
                    content.innerHTML = "<strong>" + details.name + "</strong>" + "<br />" +
                                details.formatted_address + "<br />" +
                                details.formatted_phone_number + "<br />" +
                                "<a href=" + details.website + ">" + details.website + "</a><br />" +
                                "<img width=\"240\" src=" + photoURL + "><br />" +
                                "Ocena: <span style=color:#01579b;>" + details.rating + "</span><br /><br />";
                }

                content.appendChild(button);
                button.className = 'btn-floating waves-effect waves-light green z-depth-0';

                content.appendChild(label);
                label.style.fontSize = "16px";


                button.appendChild(icon);
                icon.className = 'material-icons';

                if (trip[place.geometry.location] != undefined) {
                    icon.innerHTML = 'done';
                    label.innerHTML = ' Dodano do trasy';
                } else {
                    icon.innerHTML = 'add';
                    label.innerHTML = ' Dodaj do trasy';
                }

                button.onclick = function () {
                    button.className = 'btn-floating waves-effect waves-light green z-depth-0';
                    if (trip[place.geometry.location] != undefined) {

                        delete trip[place.geometry.location];
                        icon.innerHTML = 'add';
                        label.innerHTML = ' Dodaj do trasy';

                        marker.set('icon', null);
                    } else {

                        trip[place.geometry.location] = marker;
                        icon.innerHTML = 'done';
                        label.innerHTML = ' Dodano do trasy';

                        // wiem ze wyglada to syfsko xD ale chcialem te na trasie jakos rozroznic :D (feel free to change)
                        marker.set('icon', 'http://maps.google.com/mapfiles/ms/icons/yellow-dot.png');
                    }

                    // Takie troche na pale ale to tylko test
                    if (specMarkers.length != 0) {
                        delSpecMarkers();
                    }

                    generateTripRoute();
                }

                $(button).mouseenter(function () {
                    if (trip[place.geometry.location] != undefined) {
                        button.className = 'btn-floating waves-effect waves-light red z-depth-0';
                        icon.innerHTML = 'delete';
                        label.innerHTML = ' Usuń z trasy';
                    }
                });

                $(button).mouseleave(function () {
                    button.className = 'btn-floating waves-effect waves-light green z-depth-0';
                    if (trip[place.geometry.location] != undefined) {
                        icon.innerHTML = 'done';
                        label.innerHTML = ' Dodano do trasy';
                    } else {
                        icon.innerHTML = 'add';
                        label.innerHTML = ' Dodaj do trasy';
                    }
                });

                if (trip[place.geometry.location] != undefined) {
                    icon_list.innerHTML = 'done';
                    button_list.className = "secondary-content btn-floating waves-effect waves-light green z-depth-0"

                    label.innerHTML = ' Dodano do trasy';
                } else {
                    icon_list.innerHTML = 'add';
                    button_list.className = "secondary-content btn-floating waves-effect waves-light green z-depth-0"
                }

                infowindow.setContent(content);
                infowindow.set('maxWidth', 240);
                infowindow.open(map, marker);
            });
        }

        function delSpecMarkers()
        {
            for (var i = 0; i < specMarkers.length; ++i) {
                if (trip[specMarkers[i].position] == undefined) {
                    specMarkers[i].setMap(null);
                    delete specMarkers[i];
                }
            }
            specMarkers = [];
        }


        function addOptionalPlace(place) 
        {

            var placeLoc = place.geometry.location;
            var marker = new google.maps.Marker({
                map: map,
                position: placeLoc,
                icon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
            });

            specMarkers.push(marker);
            google.maps.event.addListener(marker, 'click', function () {
                placeDetailInfo(place, marker);
            });

        }


        function findClosestRestaurants(event)
        {
            delSpecMarkers();
            var request = {
                location: event.latLng,
                radius: placeRadius,
                types: ['restaurant']
            };
           

            placeService.nearbySearch(request, function (results, status) {
                if (status == google.maps.places.PlacesServiceStatus.OK) {
                    for (var i = 0; i < results.length; i++) {
                        addOptionalPlace(results[i]);
                    }
                }
            });

            infowindow.close();
        }


        function findClosestAtm(event)
        {
            delSpecMarkers();
            var request = {
                location: event.latLng,
                radius: placeRadius,
                types: ['atm']
            };
            
            placeService.nearbySearch(request, function (results, status) {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    for (var i = 0; i < results.length; i++) {
                        addOptionalPlace(results[i]);
                    }
                }
            });

            infowindow.close();
        }



        function startEndPointDetailsInfo(place, marker) {
            var request = { placeId: place.place_id };
            placeService.getDetails(request, function (details, status) {
                console.log(status);
                if (status !== google.maps.places.PlacesServiceStatus.OK) {
                    return;
                }

                if (infowindow != null) {
                    infowindow.close();
                } else {
                    infowindow = new google.maps.InfoWindow();
                }

                var content = document.createElement('div');
                photos = place.photos;
                if (!photos) {
                    content.innerHTML = "<strong>" + details.name + "</strong>" + "<br />" +
                        (details.formatted_address ? details.formatted_address + "<br />" : "") +
                        (details.formatted_phone_number ? details.formatted_phone_number + "<br />" : "") +
                        (details.website ? "<a href=" + details.website + ">" + details.website + "</a>" : "");
                } else {
                    var photoURL = photos[0].getUrl({ 'maxWidth': 1200, 'maxHeight': 700 });
                    content.innerHTML = "<strong>" + details.name + "</strong>" + "<br />" +
                                (details.formatted_address ? details.formatted_address + "<br />" : "") +
                                (details.formatted_phone_number ? details.formatted_phone_number + "<br />" : "") +
                                (details.website ? "<a href=" + details.website + ">" + details.website + "</a>" : "") +
                                "<img width=\"240\" src=" + photoURL + "/>";
                }

                var iconStart = document.createElement('i');
                iconStart.className = 'material-icons';

                var iconEnd = document.createElement('i');
                iconEnd.className = 'material-icons';

                var startBtn = document.createElement('a');
                startBtn.className = 'btn-floating waves-effect waves-light green z-depth-0';
                startBtn.appendChild(iconStart);

                var endBtn = document.createElement('a');
                endBtn.className = 'btn-floating waves-effect waves-light green z-depth-0';
                endBtn.appendChild(iconEnd);

                content.appendChild(document.createElement('br'));

                content.appendChild(startBtn);
                var labelStart = document.createElement('label');
                labelStart.style.fontSize = "16px";
                content.appendChild(labelStart);

                content.appendChild(document.createElement('br'));

                content.appendChild(endBtn);
                var labelEnd = document.createElement('label');
                labelEnd.style.fontSize = "16px";
                content.appendChild(labelEnd);
                

                var reStartLabel = function () {
                    if (startPlace == marker) {
                        iconStart.innerHTML = 'done';
                        labelStart.innerHTML = ' Ustalony punkt startowy';
                    } else {
                        iconStart.innerHTML = 'add';
                        labelStart.innerHTML = ' Ustaw jako punkt startowy';
                    }
                };

                var reEndLabel = function () {
                    if (endPlace == marker) {
                        iconEnd.innerHTML = 'done';
                        labelEnd.innerHTML = ' Ustalony punkt końcowy';
                    } else {
                        iconEnd.innerHTML = 'add';
                        labelEnd.innerHTML = ' Ustaw jako punkt końcowy';
                    }
                };

                var removeMarkers = function () {
                    if (startPlace != undefined && endPlace != undefined) {
                        Materialize.toast('Wybierz miejsca i dodaj je do trasy wycieczki.', 10000);

                        for (var i = 0; i < seMarkers.length; ++i) {
                            if (seMarkers[i] != startPlace && seMarkers[i] != endPlace) {
                                seMarkers[i].setMap(null);
                                delete seMarkers[i];
                            }
                        }
                        seMarkers = [];
                    }
                };

                reStartLabel();
                reEndLabel();                

                startBtn.onclick = function () {
                    startBtn.className = 'btn-floating waves-effect waves-light green z-depth-0';
                    if (startPlace != undefined) {
                        startPlace = undefined;
                    } else {
                        startPlace = marker;
                    }
                    reStartLabel();
                    removeMarkers();
                }

                $(startBtn).mouseenter(function () {
                    if (startPlace == marker) {
                        startBtn.className = 'btn-floating waves-effect waves-light red z-depth-0';
                        iconStart.innerHTML = 'delete';
                        labelStart.innerHTML = ' Usuń punkt startowy';
                    }
                });

                $(startBtn).mouseleave(function () {
                    startBtn.className = 'btn-floating waves-effect waves-light green z-depth-0';
                    reStartLabel();
                });

                // -----

                endBtn.onclick = function () {
                    endBtn.className = 'btn-floating waves-effect waves-light green z-depth-0';
                    if (endPlace != undefined) {
                        endPlace = undefined;
                    } else {
                        endPlace = marker;
                    }
                    reEndLabel();
                    removeMarkers();
                }

                $(endBtn).mouseenter(function () {
                    if (endPlace == marker) {
                        endBtn.className = 'btn-floating waves-effect waves-light red z-depth-0';
                        iconEnd.innerHTML = 'delete';
                        labelEnd.innerHTML = ' Usuń punkt końcowy';
                    }
                });

                $(endBtn).mouseleave(function () {
                    endBtn.className = 'btn-floating waves-effect waves-light green z-depth-0';
                    reEndLabel();
                });

                infowindow.setContent(content);
                infowindow.set('maxWidth', 240);
                infowindow.open(map, marker);
            });
        }

        function addStartEndPlace(place)
        {
            var marker = new google.maps.Marker({
                map: map,
                position: place.geometry.location
            });

            seMarkers.push(marker);
            google.maps.event.addListener(marker, 'click', function () {
                startEndPointDetailsInfo(place, marker);
            });

        }

        function askForStartAndEndPlace()
        {
            Materialize.toast('Wbierz skąd chcesz zacząć i gdzie chcesz zakończyć wycieczkę.', 10000);

            console.log('Select Start and End');
            /*
            TODO: zaznacz na mapie miejsca takie jak lotnisko i inne
                  zwiazane z roznymi rodzajami transportu
                 > po kliknieciu na takie miejsce ma bys opcja ustawienia go jako punkt startowy/koncowy 
                 > klikniecie w dowolnym miejscu na mapie tez pozwala wybrac je jako punkt startowy/koncowy
            */

            var request = {
                location: autocompleteCities.getPlace().geometry.location,
                radius: 5000,
                types: ['airport', 'bus_station', 'subway_station', 'train_station']
            };

            placeService.nearbySearch(request, function (results, status) {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    for (var i = 0; i < results.length; ++i) {
                        addStartEndPlace(results[i]);
                    }
                }
            });
        }


        function generateTripRoute()
        {
            /*
            WARNING: podstawowe api pozwala na 8 punktow (wliczajac start i koniec) :/
            */

            if (startPlace == null || endPlace == null) {
                Materialize.toast('Nie wybrano miejsca początkowego lub końcowego wycieczki.', 4000);
                return;
            }

            var places = [];
            for (var k in trip) {
                places.push(k);
            }

            var waypoints = places.map(function (item) {
                return {
                    location: item,
                    stopover: true
                };
            });

            directionsService.route({
                origin: startPlace.position,
                destination: endPlace.position,
                waypoints: waypoints,
                optimizeWaypoints: true,
                travelMode: google.maps.TravelMode.WALKING
            }, function (response, status) {
                if (status == google.maps.DirectionsStatus.OK) {
                    directionsDisplay.setMap(map);
                    directionsDisplay.setDirections(response);
                }
            });

        }


        /*
        Main loading
        */
        google.maps.event.addDomListener(window, 'load', function () {
            loadMapAndPlaceService();

            setupCitiesAutocomplete();

            google.maps.event.addListener(map, "rightclick", showOptions);

            setupCheckboxListener();


            directionsService = new google.maps.DirectionsService();
            directionsDisplay = new google.maps.DirectionsRenderer({
                map: map,
                preserveViewport: true,
                suppressMarkers: true,
            });

            //var markers = [];
            //var directions = new google.maps.DirectionsService();
            //var directionsDisplay = new google.maps.DirectionsRenderer({ map: map });
            //$(':checkbox').change(function () {
            //    var placeMap = {
            //        'Monuments': ['city_hall', 'museum', 'point_of_interest'],
            //        'Club': ['bar', 'cafe'],
            //        'Food': ['restaurant', 'meal_takeaway'],
            //        //'Art': ['art_gallery'],
            //        'Cinema': ['movie_theater'],
            //        //'Fun': ['amusement_park', 'zoo']
            //    };

            //    var currentSearch = [];
            //    $(':checkbox').each(function () {
            //        if (this.checked) {
            //            currentSearch = currentSearch.concat(placeMap[this.id]);
            //        }
            //    });

            //    for (var i = 0; i < markers.length; ++i) {
            //        markers[i].setMap(null);
            //        delete markers[i];
            //    }

            //    markers = [];

            //    directionsDisplay.setMap(null);
            //    directionsDisplay.setDirections(null);

            //    if (currentSearch.length == 0) {
            //        return;
            //    }

            //    infowindow = new google.maps.InfoWindow();
            //    service = new google.maps.places.PlacesService(map);

            //    service.nearbySearch({
            //        location: autocomplete.getPlace().geometry.location,
            //        radius: 2500,
            //        types: currentSearch
            //    }, callback);

            //    function callback(results, status) {
            //        if (status === google.maps.places.PlacesServiceStatus.OK) {
            //            var places = results.filter(function (place) {
            //                return place.rating > 4.0;
            //            }).sort(function (a, b) {
            //                return a.rating < b.rating;
            //            }).slice(0, 8);
            //            for (var i = 0; i < places.length; i++) {
            //                placeDetailInfo(places[i]);
            //            }
            //            var waypoints = places.map(function (item) {
            //                return {
            //                    location: item.geometry.location.toUrlValue(),
            //                    stopover: true
            //                };
            //            });

            //            directions.route({
            //                origin: waypoints[0]['location'],
            //                destination: waypoints[waypoints.length - 1]['location'],
            //                waypoints: waypoints.slice(1, waypoints.length - 1),
            //                optimizeWaypoints: true,
            //                travelMode: google.maps.TravelMode.WALKING
            //            }, function (response, status) {
            //                if (status == google.maps.DirectionsStatus.OK) {
            //                    directionsDisplay.setMap(map);
            //                    directionsDisplay.setDirections(response);
            //                }
            //            });
            //        }
            //    }
                
            //});
        });



        @*google.maps.event.addDomListener(window, 'load', function () {
            var mapCanvas = document.getElementById('map');
            var mapOptions = {
                center: new google.maps.LatLng(50.0468548, 19.9348337),
                zoom: 12,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            var map = new google.maps.Map(mapCanvas, mapOptions);

            var defaultBounds = new google.maps.LatLngBounds(
                new google.maps.LatLng(-90, -180),
                new google.maps.LatLng(90, 180));

            var autocompleteOptions = {
                bounds: defaultBounds,
                types: ['(cities)']
            };

            var autocomplete = new google.maps.places.Autocomplete(document.getElementById('city_poc'), autocompleteOptions);
            google.maps.event.addListener(autocomplete, 'place_changed', function () {
                var place = autocomplete.getPlace();
                map.panTo(place.geometry.location);
            });

            var markers = [];

            var directions = new google.maps.DirectionsService();
            var directionsDisplay = new google.maps.DirectionsRenderer({ map: map });

            $(':checkbox').change(function () {
                var placeMap = {
                    'Monuments': ['city_hall', 'museum', 'point_of_interest'],
                    'Club': ['bar', 'cafe'],
                    'Food': ['restaurant', 'meal_takeaway'],
                    'Art': ['art_gallery'],
                    'Cinema': ['movie_theater'],
                    'Fun': ['amusement_park', 'zoo']
                };

                var currentSearch = [];
                $(':checkbox').each(function () {
                    if (this.checked) {
                        currentSearch = currentSearch.concat(placeMap[this.id]);
                    }
                });

                for (var i = 0; i < markers.length; ++i) {
                    markers[i].setMap(null);
                    delete markers[i];
                }

                markers = [];

                directionsDisplay.setMap(null);
                directionsDisplay.setDirections(null);

                if (currentSearch.length == 0) {
                    return;
                }

                var infowindow = new google.maps.InfoWindow();
                var service = new google.maps.places.PlacesService(map);

                service.nearbySearch({
                    location: autocomplete.getPlace().geometry.location,
                    radius: 2500,
                    types: currentSearch
                }, function (results, status) {
                    if (status == google.maps.places.PlacesServiceStatus.OK) {
                        var places = results.filter(function (place) {
                            return place.rating > 4.0;
                        }).sort(function (a, b) {
                            return a.rating < b.rating;
                        }).slice(0, 8);

                        for (var i = 0; i < places.length; ++i) {
                            var place = places[i];
                            var marker = new google.maps.Marker({
                                map: map,
                                position: place.geometry.location
                            });

                            markers.push(marker);

                            google.maps.event.addListener(marker, 'click', function () {
                                infowindow.setContent(place.name);
                                infowindow.open(map, this);
                            });
                        }

                        var waypoints = places.map(function (item) {
                            return {
                                location: item.geometry.location.toUrlValue(),
                                stopover: true
                            };
                        });

                        directions.route({
                            origin: waypoints[0]['location'],
                            destination: waypoints[waypoints.length-1]['location'],
                            waypoints: waypoints.slice(1, waypoints.length - 1),
                            optimizeWaypoints: true,
                            travelMode: google.maps.TravelMode.WALKING
                        }, function (response, status) {
                            if (status == google.maps.DirectionsStatus.OK) {
                                directionsDisplay.setMap(map);
                                directionsDisplay.setDirections(response);
                            }
                        });
                    }
                });
            });
        });*@
        

        $('.datepicker').pickadate({
            selectMonths: true, // Creates a dropdown to control month
            selectYears: 2, // Creates a dropdown of 15 years to control year
            monthsFull: ['Styczeń', 'Luty', 'Marzec', 'Kwiecień', 'Maj', 'Czerwiec', 'Lipiec', 'Sierpień', 'Wrzesień', 'Październik', 'Listopad', 'Grudzień'],
            monthsShort: ['Styczeń', 'Luty', 'Marzec', 'Kwiecień', 'Maj', 'Czerwiec', 'Lipiec', 'Sierpień', 'Wrzesień', 'Październik', 'Listopad', 'Grudzień'],
            weekdaysFull: ['Niedziela', 'Poniedziałek', 'Wtorek', 'Środa', 'Czwartek', 'Piątek', 'Sobota'],
            weekdaysShort: ['Niedz.', 'Pon.', 'Wt.', 'Śr', 'Czw.', 'Pt.', 'Sob.'],
            today: 'Dziś',
            clear: 'Wyczyść',
            close: 'Zamknij',
            labelMonthNext: 'Następny miesiąc',
            labelMonthPrev: 'Poprzedni miesiąc',
            labelMonthSelect: 'Wybierz miesiąc',
            labelYearSelect: 'Wybierz rok',
        });
    </script>
}